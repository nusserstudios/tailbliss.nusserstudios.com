<meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
<link rel="manifest" href="/favicon/site.webmanifest">
<link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
{{ partial "meta" . }}

{{/* Preload critical hero image for better LCP performance */}}
{{ if .IsHome }}
<link rel="preload" as="image" href="/images/tailbliss-rocket-indigo.webp" fetchpriority="high">
{{ end }}

{{/* Hide Alpine.js [x-cloak] elements until Alpine initializes to prevent nav menu flicker.
 The x-cloak directive is located in the head partial to prevent rollup from Vite. */}}
<style>
 [x-cloak] { display: none !important; }
 
 /* Critical CSS for above-the-fold content */
 .hero-section { min-height: 50vh; }
 .hero-text { font-size: 2.25rem; line-height: 2.5rem; font-weight: 800; }
 .hero-image { max-width: 36rem; width: 100%; height: auto; border-radius: 0.5rem; }
 @media (min-width: 640px) { .hero-text { font-size: 3rem; line-height: 1; } }
</style>

<script>
    // On page load or when changing themes, best to add inline in `head` to avoid FOUC
    if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
    } else {
        document.documentElement.classList.remove('dark')
    }
</script>
{{/* Use Vite-generated CSS files with cache busting hashes */}}
{{ $cssFiles := readDir "themes/tailbliss/static/css" }}
{{ $mainCSS := "" }}
{{ range $cssFiles }}
  {{ if strings.Contains .Name "main." }}
    {{ if strings.HasSuffix .Name ".css" }}
      {{ $mainCSS = .Name }}
    {{ end }}
  {{ end }}
{{ end }}

{{ if $mainCSS }}
<link rel="preload" href="/css/{{ $mainCSS }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="/css/{{ $mainCSS }}"></noscript>
{{ else }}
{{/* Fallback to Hugo PostCSS processing if Vite file not found */}}
{{ $styles := resources.Get "css/main.css" }}
{{ if $styles }}
{{ $styles := $styles | postCSS }}
{{ if hugo.IsProduction }}
{{ $styles := $styles | minify | fingerprint | resources.PostProcess }}
{{ end }}
<link rel="stylesheet" href="{{ $styles.RelPermalink }}" />
{{ else }}
{{/* Final fallback - try to load from theme assets */}}
{{ $styles := resources.Get "css/main.css" }}
{{ if $styles }}
<link rel="stylesheet" href="{{ $styles.RelPermalink }}" />
{{ end }}
{{ end }}
{{ end }}